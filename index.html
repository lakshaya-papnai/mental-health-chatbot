<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuronauts | Mental Wellness AI</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f0fdfa;
            --surface-color: #ffffff;
            --primary-color: #0d9488;
            --primary-light: #ccfbf1;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-color: rgba(13, 148, 136, 0.1);
        }

        body.dark-mode {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #3a96ff;
            --primary-light: #2a3a5e;
            --text-primary: #e5e5e5;
            --text-secondary: #888888;
            --border-color: #333333;
            --shadow-color: rgba(58, 150, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow: hidden;
        }

        .header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--surface-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
            flex-shrink: 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-grow: 1;
        }

        .logo {
            color: var(--primary-color);
        }

        .header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .header .team-name {
            font-weight: 400;
            color: var(--text-secondary);
        }
        
        .theme-toggle-button {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .theme-toggle-button:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
            transform: rotate(15deg);
        }

        .theme-toggle-button .icon-sun { display: none; }
        .theme-toggle-button .icon-moon { display: block; }
        body.dark-mode .theme-toggle-button .icon-sun { display: block; }
        body.dark-mode .theme-toggle-button .icon-moon { display: none; }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 0 1rem;
            overflow: hidden;
        }

        .messages {
            flex: 1;
            padding: 2rem 0;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .messages::-webkit-scrollbar {
            display: none;
        }
        .messages {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .message {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user { justify-content: flex-end; }
        .message.assistant { justify-content: flex-start; }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow: hidden;
        }
        
        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .message.user .message-avatar {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .message.assistant .message-avatar {
            background-color: var(--surface-color);
        }
        
        body.dark-mode .message.assistant .message-avatar {
            background-color: var(--surface-color);
        }

        .message-content {
            max-width: 75%;
            padding: 0.875rem 1.25rem;
            border-radius: 1.25rem;
            position: relative;
            line-height: 1.6;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .message.user .message-content {
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 0.5rem;
        }

        .message.assistant .message-content {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-bottom-left-radius: 0.5rem;
        }
        
        .input-container {
            padding: 1rem;
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 5px rgba(0,0,0,0.03);
            flex-shrink: 0;
            z-index: 10;
        }

        .input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .input-field {
            flex: 1;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 1.25rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            resize: none;
            min-height: 50px;
            max-height: 150px;
            overflow-y: auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .input-field::placeholder { color: var(--text-secondary); }

        .send-button {
            background-color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            flex-shrink: 0;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .typing-indicator-content { display: flex; gap: 0.5rem; align-items: center; }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            padding: 2rem;
            height: 100%;
        }

        .empty-state-icon {
            width: 90px;
            height: 90px;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow: hidden;
            border: 3px solid var(--surface-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .empty-state-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .empty-state h2 { font-size: 1.75rem; margin-bottom: 0.75rem; color: var(--text-primary); }
        .empty-state p { color: var(--text-secondary); font-size: 1rem; max-width: 450px; margin-bottom: 2rem; }
        .suggestion-chips { display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: center; }
        .chip {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            padding: 0.625rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .chip:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .header { padding: 0.75rem 1rem; }
            .header h1 { font-size: 1.1rem; }
            .chat-container { padding: 0 0.5rem; }
            .message-content { max-width: 85%; }
            .input-container { padding: 0.75rem; }
            .input-field { padding: 0.625rem 0.875rem; min-height: 48px; }
            .send-button { width: 48px; height: 48px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v1.2a.5.5 0 0 0 .5.5h1.2a2.5 2.5 0 0 1 0 5h-1.2a.5.5 0 0 0-.5.5v1.2a2.5 2.5 0 0 1-5 0v-1.2a.5.5 0 0 0-.5-.5H4.8a2.5 2.5 0 0 1 0-5h1.2a.5.5 0 0 0 .5-.5V4.5A2.5 2.5 0 0 1 9.5 2zM12 14.8a.5.5 0 0 0 .5.5h1.2a2.5 2.5 0 0 1 0 5h-1.2a.5.5 0 0 0-.5.5v1.2a2.5 2.5 0 0 1-5 0v-1.2a.5.5 0 0 0-.5-.5H4.8a2.5 2.5 0 0 1 0-5h1.2a.5.5 0 0 0 .5-.5v-1.2a2.5 2.5 0 0 1 5 0v1.2z"/></svg>
            </div>
            <h1>Mental Wellness AI <span class="team-name">by Neuronauts</span></h1>
        </div>
        <button class="theme-toggle-button" id="theme-toggle" aria-label="Toggle dark mode">
            <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages">
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">
                    <img src="cute-white-doctor-robot-modern-600nw-1072509989.jpg" alt="AI Doctor Assistant" onerror="this.style.display='none'">
                </div>
                <h2>Your confidential space to talk.</h2>
                <p>I'm your AI wellness assistant, here to listen without judgment. What's on your mind today?</p>
                <div class="suggestion-chips">
                    <div class="chip">"I'm feeling stressed about work"</div>
                    <div class="chip">"How can I practice mindfulness?"</div>
                    <div class="chip">"I just need to vent for a bit"</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-container">
        <div class="input-wrapper">
            <textarea 
                 class="input-field" 
                 id="messageInput" 
                 placeholder="You can share anything here..." 
                 rows="1"
            ></textarea>
            <button class="send-button" id="sendButton">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="m18 11-6-6-6 6"/></svg>
            </button>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const emptyState = document.getElementById('emptyState');
        const themeToggleButton = document.getElementById('theme-toggle');
        let conversationHistory = [];
        
        const userAvatarIcon = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`;
        const aiAvatarImg = `<img src="cute-white-doctor-robot-modern-600nw-1072509989.jpg" alt="AI Assistant" onerror="this.style.display='none'">`;
        
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }
        
        themeToggleButton.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        });

        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });

        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);
        
        document.querySelectorAll('.chip').forEach(chip => {
            chip.addEventListener('click', () => {
                const message = chip.textContent.replace(/"/g, '');
                messageInput.value = message;
                messageInput.focus();
                messageInput.dispatchEvent(new Event('input', { bubbles: true }));
            });
        });

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            if (emptyState && emptyState.style.display !== 'none') {
                emptyState.style.display = 'none';
            }

            addMessage(message, 'user');
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendButton.disabled = true;

            showTypingIndicator();
            sendToWebhook(message);
        }

        function addMessage(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = type === 'user' ? userAvatarIcon : aiAvatarImg;

            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
            `;
            
            if (type === 'user') {
                messageDiv.style.flexDirection = 'row-reverse';
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            conversationHistory.push({ role: type, content: content });
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">${aiAvatarImg}</div>
                <div class="message-content typing-indicator-content">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendToWebhook(message) {
            try {
                const webhookUrl = 'https://lakshaya.app.n8n.cloud/webhook/mental-health-chatbot';

                if (!sessionStorage.getItem('chatSessionId')) {
                    sessionStorage.setItem('chatSessionId', 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9));
                }

                const payload = {
                    question: message,
                    sessionId: sessionStorage.getItem('chatSessionId'),
                    conversation_history: conversationHistory,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    source: 'mental_health_chatbot'
                };

                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let aiResponse;

                if (data.answer) {
                    aiResponse = data.answer;
                } else {
                    aiResponse = 'I apologize, but I received an unexpected response. Please try again.';
                    console.error('Unexpected response format:', data);
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'assistant');

            } catch (error) {
                console.error('Error sending to webhook:', error);
                hideTypingIndicator();
                let errorMessage = 'I apologize, but I\'m having trouble connecting. Please ensure the backend is running and try again.';
                addMessage(errorMessage, 'assistant');
            } finally {
                sendButton.disabled = false;
            }
        }
    </script>
</body>
</html>
